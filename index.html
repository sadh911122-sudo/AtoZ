<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스트레스 요인 유형 진단</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            padding: 20px;
            background: #f8f9ff;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s ease;
        }

        .step.active {
            background: #6a11cb;
            color: white;
        }

        .step.completed {
            background: #4CAF50;
            color: white;
        }

        .content {
            padding: 40px;
            min-height: 400px;
        }

        .card-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .card-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 정보 입력 페이지 스타일 */
        .info-form {
            text-align: center;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #6a11cb;
        }

        .intro-text {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1em;
            color: #666;
            line-height: 1.6;
        }

        /* 질문 페이지 스타일 */
        .question-container {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9ff;
            border-radius: 15px;
            border-left: 5px solid #6a11cb;
            transition: all 0.3s ease;
        }

        .question-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .question {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.5;
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .scale-options {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }

        .scale-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .scale-option:hover {
            background: #e8ecff;
        }

        .radio-custom {
            width: 25px;
            height: 25px;
            border: 2px solid #6a11cb;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .radio-custom.selected {
            background: #6a11cb;
            box-shadow: inset 0 0 0 4px white;
        }

        .scale-number {
            margin-top: 5px;
            font-weight: bold;
            color: #6a11cb;
        }

        /* 결과 페이지 스타일 */
        .result-container {
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin: -40px -40px 0 -40px;
        }

        .result-title {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-type {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
        }

        .result-scores {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .result-detail {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .detail-section {
            margin-bottom: 15px;
        }

        .detail-title {
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 8px;
            color: #fff;
        }

        .detail-content {
            font-size: 0.95em;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }

        .program-list {
            list-style: none;
            padding: 0;
        }

        .program-list li {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 5px;
        }

        .reason-list {
            list-style: none;
            padding: 0;
        }

        .reason-list li {
            padding: 5px 0;
            position: relative;
            padding-left: 15px;
        }

        .reason-list li:before {
            content: "•";
            position: absolute;
            left: 0;
            color: #fff;
        }

        /* 버튼 스타일 */
        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(106, 17, 203, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-white {
            background: white;
            color: #6a11cb;
        }

        .btn-white:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-success {
            background: #4CAF50;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            width: 0%;
            transition: width 0.3s ease;
        }

        .navigation-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .success-message {
            text-align: center;
            padding: 30px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .success-icon {
            font-size: 3em;
            color: #4CAF50;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .scale-labels {
                font-size: 0.8em;
            }
            
            .radio-custom {
                width: 20px;
                height: 20px;
            }

            .navigation-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>스트레스 요인 유형 진단</h1>
            <p>나의 스트레스 요인 유형을 파악하고 맞춤형 프로그램을 추천받으세요</p>
        </div>

        <div class="step-indicator">
            <div class="step active" id="step1">1</div>
            <div class="step" id="step2">2</div>
            <div class="step" id="step3">3</div>
            <div class="step" id="step4">4</div>
        </div>

        <div class="content">
            <!-- 1단계: 정보 입력 -->
            <div class="card-section active" id="section1">
                <div class="info-form">
                    <div class="intro-text">
                        <h2 style="margin-bottom: 15px; color: #333;">진단을 시작하기 전에<br>기본 정보를 입력해주세요</h2>
                        <p>입력하신 정보는 프로그램 추천 및 연락을 위해 사용됩니다.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="company">소속 기관</label>
                        <input type="text" id="company" placeholder="소속 기관을 입력해주세요" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="department">부서명</label>
                        <input type="text" id="department" placeholder="소속 부서명을 입력해주세요" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="name">성명</label>
                        <input type="text" id="name" placeholder="성명을 입력해주세요" required>
                    </div>
                    
                    <button class="btn" id="startBtn">진단 시작하기</button>
                </div>
            </div>

            <!-- 2단계: 진단 질문 -->
            <div class="card-section" id="section2">
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
                <div id="questions-container"></div>
                <div class="navigation-buttons">
                    <button class="btn btn-secondary" id="prevBtn">이전</button>
                    <button class="btn" id="submitBtn" disabled>결과 확인하기</button>
                </div>
            </div>

            <!-- 3단계: 결과 표시 -->
            <div class="card-section" id="section3">
                <div class="result-container" id="resultContainer">
                    <div class="result-title">진단 결과</div>
                    <div class="result-type" id="resultType"></div>
                    <div class="result-scores" id="resultScores"></div>
                    <div id="recommendation"></div>
                    
                    <button class="btn btn-white" id="saveBtn">
                        데이터 저장하기
                    </button>
                </div>
            </div>

            <!-- 4단계: 완료 및 프로그램 신청 -->
            <div class="card-section" id="section4">
                <div class="success-message">
                    <div class="success-icon">✅</div>
                    <h2 style="color: #4CAF50; margin-bottom: 10px;">데이터 저장이 완료되었습니다!</h2>
                    <p style="color: #666;">진단 결과가 성공적으로 저장되었습니다.</p>
                </div>
                
                <div style="text-align: center;">
                    <h3 style="margin-bottom: 20px; color: #333;">다음 단계</h3>
                    <p style="margin-bottom: 25px; color: #666; line-height: 1.6;">
                        맞춤형 스트레스 관리 프로그램에 신청하시겠습니까?<br>
                        전문가가 귀하의 진단 결과를 바탕으로 최적의 프로그램을 제안해드립니다.
                    </p>
                    
                    <a href="https://forms.gle/3hiN1RLNDURZjKZL9" target="_blank" class="btn" style="text-decoration: none; display: inline-block;">
                        스트레스 관리 프로그램 신청하기
                    </a>
                    
                    <button class="btn btn-secondary" id="restartBtn" style="margin-top: 15px;">
                        새로운 진단 시작하기
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
// 전역 변수
var currentStep = 1;
var userInfo = {};
var answers = {};
var totalQuestions = 18;
var diagnosisData = null;

// 질문 데이터
var questions = [
    { text: "나는 업무량이 지나치게 많다고 느낀다.", type: 'job' },
    { text: "나는 직장 내 동료들과의 소통에 어려움을 느낀다.", type: 'relationship' },
    { text: "나는 일에 대한 열정이 예전보다 많이 줄었다.", type: 'burnout' },
    { text: "나는 업무 마감일이 항상 촉박하다고 느낀다.", type: 'job' },
    { text: "아무리 쉬어도 피로가 쉽게 회복되지 않는다.", type: 'burnout' },
    { text: "나는 상사 또는 부하직원과의 갈등으로 스트레스를 받는다.", type: 'relationship' },
    { text: "나는 일을 하면서 실수를 두려워하게 된다.", type: 'job' },
    { text: "직장에서의 인간관계로 인해 피로감을 느낀다.", type: 'relationship' },
    { text: "출근을 생각하면 무기력하거나 불안한 느낌이 든다.", type: 'burnout' },
    { text: "팀워크보다는 개인주의적인 분위기가 더 강하다고 느낀다.", type: 'relationship' },
    { text: "상사의 기대나 요구가 부담스럽다고 느낀다.", type: 'job' },
    { text: "일에 대해 무감각하거나 기계적으로 처리하는 경향이 있다.", type: 'burnout' },
    { text: "나는 일 때문에 개인 시간이 부족하다고 느낀다.", type: 'job' },
    { text: "업무로 인해 감정 소모가 매우 크다고 느낀다.", type: 'burnout' },
    { text: "나는 다른 사람의 눈치를 자주 본다.", type: 'relationship' },
    { text: "요즘 들어 '이 일이 나에게 무슨 의미가 있나?'라는 생각이 자주 든다.", type: 'burnout' },
    { text: "업무 성과에 대한 평가가 불공정하다고 느낄 때가 많다.", type: 'job' },
    { text: "인간관계에서 갈등이 생기면 쉽게 풀지 못하고 오래 끌게 된다.", type: 'relationship' }
];

var stressTypes = {
    job: { name: "직무 스트레스" },
    relationship: { name: "관계 갈등" },
    burnout: { name: "번아웃 증후군" }
};

var stressInfo = {
    job: {
        characteristics: "업무량 과다, 마감 압박, 평가 불안, 워라밸 부족, 역할 혼란, 과중한 기대",
        healingKeywords: "이완, 신체 회복, 자연, 리듬",
        programs: ["요가 + 바디무브먼트 프로그램", "자연 숲 워킹 테라피"],
        reasons: ["과도한 업무로 인한 긴장 해소", "신체 긴장과 정신 몰입을 함께 완화", "조용한 반복 동작이 심리적 안정감 제공"]
    },
    relationship: {
        characteristics: "상사·동료와의 갈등, 소통 불안, 팀워크 부족, 피드백 회피, 대인 스트레스 잦음",
        healingKeywords: "감정 표현, 창작, 비언어 소통",
        programs: ["뮤직 테라피", "공예/아트 테라피", "컬러 테라피"],
        reasons: ["감정 표현의 통로 제공 (음악/미술)", "심리적 거리두기, 자기객관화 가능", "언어적 대화보다 감정 해소에 용이"]
    },
    burnout: {
        characteristics: "감정 소진, 무기력, 회의감, 열정 상실, 자기효능감 저하, 출근 스트레스 극심",
        healingKeywords: "쉼, 향기, 따뜻함, 비생산성",
        programs: ["아로마테라피", "티 블렌딩 + 마인드풀니스", "쉼 기반의 리커버리 캠프"],
        reasons: ["정신적 탈진 회복에 효과적", "향기, 따뜻함, 자연요소가 회복력 촉진", "심리적 '쉼'과 재충전 중심"]
    }
};

// 단계 이동
function goToStep(step) {
    console.log('단계 이동:', step);
    
    // 유효성 검사
    if (step === 2 && currentStep === 1) {
        if (!validateUserInfo()) return;
    }
    if (step === 3 && currentStep === 2) {
        if (!validateAnswers()) return;
        displayResults();
    }

    // 이전 단계 숨기기
    var currentSection = document.getElementById('section' + currentStep);
    var currentStepElement = document.getElementById('step' + currentStep);
    
    if (currentSection) currentSection.classList.remove('active');
    if (currentStepElement) currentStepElement.classList.remove('active');
    
    if (currentStep < step && currentStepElement) {
        currentStepElement.classList.add('completed');
    }

    // 새 단계 표시
    currentStep = step;
    var newSection = document.getElementById('section' + currentStep);
    var newStepElement = document.getElementById('step' + currentStep);
    
    if (newSection) newSection.classList.add('active');
    if (newStepElement) newStepElement.classList.add('active');

    // 2단계일 때 질문 렌더링
    if (step === 2) {
        var container = document.getElementById('questions-container');
        if (container && !container.hasChildNodes()) {
            renderQuestions();
        }
    }
}

// 사용자 정보 유효성 검사
function validateUserInfo() {
    var company = document.getElementById('company').value.trim();
    var department = document.getElementById('department').value.trim();
    var name = document.getElementById('name').value.trim();

    if (!company || !department || !name) {
        alert('모든 정보를 입력해주세요.');
        return false;
    }

    userInfo = { company: company, department: department, name: name };
    return true;
}

// 답변 유효성 검사
function validateAnswers() {
    if (Object.keys(answers).length !== totalQuestions) {
        alert('모든 문항에 답변해주세요.');
        return false;
    }
    return true;
}

// 질문 렌더링
function renderQuestions() {
    var container = document.getElementById('questions-container');
    
    for (var i = 0; i < questions.length; i++) {
        var question = questions[i];
        var questionDiv = document.createElement('div');
        questionDiv.className = 'question-container';
        
        var scaleOptionsHtml = '';
        for (var value = 1; value <= 5; value++) {
            scaleOptionsHtml += '<div class="scale-option" onclick="selectAnswer(' + i + ', ' + value + ')">' +
                '<div class="radio-custom" id="radio_' + i + '_' + value + '"></div>' +
                '<span class="scale-number">' + value + '</span>' +
                '</div>';
        }
        
        questionDiv.innerHTML = 
            '<div class="question">' + (i + 1) + '. ' + question.text + '</div>' +
            '<div class="scale-labels">' +
                '<span>전혀 그렇지 않다</span>' +
                '<span>그렇지 않다</span>' +
                '<span>보통이다</span>' +
                '<span>그렇다</span>' +
                '<span>매우 그렇다</span>' +
            '</div>' +
            '<div class="scale-options">' + scaleOptionsHtml + '</div>';
        
        container.appendChild(questionDiv);
    }
}

// 답변 선택
function selectAnswer(questionIndex, value) {
    // 이전 선택 해제
    for (var i = 1; i <= 5; i++) {
        var radio = document.getElementById('radio_' + questionIndex + '_' + i);
        if (radio) radio.classList.remove('selected');
    }
    
    // 새 선택 표시
    var selectedRadio = document.getElementById('radio_' + questionIndex + '_' + value);
    if (selectedRadio) selectedRadio.classList.add('selected');
    
    answers[questionIndex] = parseInt(value);
    updateProgress();
    checkComplete();
}

// 진행률 업데이트
function updateProgress() {
    var answered = Object.keys(answers).length;
    var progress = (answered / totalQuestions) * 100;
    var progressBar = document.getElementById('progressBar');
    if (progressBar) {
        progressBar.style.width = progress + '%';
    }
}

// 완료 체크
function checkComplete() {
    var submitBtn = document.getElementById('submitBtn');
    if (submitBtn) {
        if (Object.keys(answers).length === totalQuestions) {
            submitBtn.disabled = false;
            submitBtn.textContent = '결과 확인하기';
        } else {
            submitBtn.disabled = true;
            submitBtn.textContent = '답변 완료 (' + Object.keys(answers).length + '/' + totalQuestions + ')';
        }
    }
}

// 결과 계산
function calculateResults() {
    var scores = { job: 0, relationship: 0, burnout: 0 };

    for (var questionIndex in answers) {
        var type = questions[questionIndex].type;
        if (type && scores[type] !== undefined) {
            scores[type] += answers[questionIndex];
        }
    }

    var sortedScores = [];
    for (var type in scores) {
        sortedScores.push({ type: type, score: scores[type], name: stressTypes[type].name });
    }
    
    sortedScores.sort(function(a, b) { return b.score - a.score; });

    return { scores: scores, sortedScores: sortedScores };
}

// 결과 표시
function displayResults() {
    var results = calculateResults();
    var scores = results.scores;
    var sortedScores = results.sortedScores;
    var highestType = sortedScores[0].type;
    var info = stressInfo[highestType];
    
    // 진단 데이터 저장
    diagnosisData = {
        company: userInfo.company,
        department: userInfo.department,
        name: userInfo.name,
        jobScore: scores.job,
        relationshipScore: scores.relationship,
        burnoutScore: scores.burnout,
        mainStressType: sortedScores[0].name,
        answers: answers
    };
    
    var resultType = document.getElementById('resultType');
    if (resultType) {
        resultType.textContent = '주요 스트레스 유형: ' + sortedScores[0].name;
    }
    
    var resultScores = document.getElementById('resultScores');
    if (resultScores) {
        var scoresHtml = '<h3 style="margin-bottom: 15px;">유형별 점수</h3>';
        for (var i = 0; i < sortedScores.length; i++) {
            var item = sortedScores[i];
            scoresHtml += '<div class="score-item">' +
                '<span>' + (i + 1) + '위. ' + item.name + '</span>' +
                '<strong>' + item.score + '점</strong>' +
                '</div>';
        }
        resultScores.innerHTML = scoresHtml;
    }
    
    var recommendation = document.getElementById('recommendation');
    if (recommendation) {
        var programsHtml = '';
        for (var i = 0; i < info.programs.length; i++) {
            programsHtml += '<li>' + info.programs[i] + '</li>';
        }
        
        var reasonsHtml = '';
        for (var i = 0; i < info.reasons.length; i++) {
            reasonsHtml += '<li>' + info.reasons[i] + '</li>';
        }
        
        recommendation.innerHTML = 
            '<h3 style="margin-bottom: 20px; color: white;">상세 진단 결과</h3>' +
            '<div class="result-detail">' +
                '<div class="detail-section">' +
                    '<div class="detail-title">주요 특성</div>' +
                    '<div class="detail-content">' + info.characteristics + '</div>' +
                '</div>' +
                '<div class="detail-section">' +
                    '<div class="detail-title">힐링 키워드</div>' +
                    '<div class="detail-content">' + info.healingKeywords + '</div>' +
                '</div>' +
                '<div class="detail-section">' +
                    '<div class="detail-title">제안 프로그램</div>' +
                    '<ul class="program-list">' + programsHtml + '</ul>' +
                '</div>' +
                '<div class="detail-section">' +
                    '<div class="detail-title">추천 이유</div>' +
                    '<ul class="reason-list">' + reasonsHtml + '</ul>' +
                '</div>' +
            '</div>';
    }
}

// 데이터 저장 및 4단계 이동
function saveDataAndGoToStep4() {
    if (!diagnosisData) {
        alert('진단 데이터가 없습니다.');
        return;
    }

    var btn = document.getElementById('saveBtn');
    btn.textContent = '저장 중...';
    btn.disabled = true;

    try {
        var url = 'https://script.google.com/macros/s/AKfycbwPVZ45m9Jw3DTnHH7OgWTaiJUp71yM7hVOVTKJI8KKVNf54gso0wFGWPZRVpR57RF9Vw/exec';
        
        // 파라미터 개별 확인 및 URL 구성
        var timestamp = new Date().toLocaleString('ko-KR');
        var company = diagnosisData.company || '';
        var department = diagnosisData.department || '';
        var name = diagnosisData.name || '';
        var jobScore = diagnosisData.jobScore || 0;
        var relationshipScore = diagnosisData.relationshipScore || 0;
        var burnoutScore = diagnosisData.burnoutScore || 0;
        var mainStressType = diagnosisData.mainStressType || '';
        var answers = JSON.stringify(diagnosisData.answers || {});

        // 전송할 데이터 디버깅 출력
        console.log('=== 전송할 데이터 확인 ===');
        console.log('타임스탬프:', timestamp);
        console.log('소속 기관:', company);
        console.log('부서명:', department);
        console.log('성명:', name);
        console.log('직무 스트레스:', jobScore);
        console.log('관계 갈등:', relationshipScore);
        console.log('번아웃:', burnoutScore);
        console.log('주요 유형:', mainStressType);
        console.log('전체 답변:', answers);
        console.log('========================');

        // URL 파라미터 구성 (한글 인코딩 강화)
        var params = [];
        params.push('timestamp=' + encodeURIComponent(timestamp));
        params.push('소속 기관=' + encodeURIComponent(company));
        params.push('부서명=' + encodeURIComponent(department));
        params.push('성명=' + encodeURIComponent(name));
        params.push('직무스트레스점수=' + encodeURIComponent(jobScore));
        params.push('관계갈등점수=' + encodeURIComponent(relationshipScore));
        params.push('번아웃점수=' + encodeURIComponent(burnoutScore));
        params.push('주요스트레스유형=' + encodeURIComponent(mainStressType));
        params.push('전체응답데이터=' + encodeURIComponent(answers));
        
        var fullUrl = url + '?' + params.join('&');
        console.log('최종 전송 URL:', fullUrl);

        // fetch를 사용한 데이터 전송 시도
        if (typeof fetch !== 'undefined') {
            fetch(fullUrl, {
                method: 'GET',
                mode: 'no-cors'
            }).then(function() {
                btn.textContent = '저장 완료!';
                btn.style.background = '#4CAF50';
                goToStep(4);
                console.log('데이터 저장 완료 (fetch)');
            }).catch(function(error) {
                console.log('fetch 오류지만 데이터는 전송됨:', error);
                btn.textContent = '저장 완료!';
                btn.style.background = '#4CAF50';
                goToStep(4);
            });
        } else {
            // Image 객체를 사용한 데이터 전송 (CORS 회피)
            var img = new Image();
            img.onload = function() {
                btn.textContent = '저장 완료!';
                btn.style.background = '#4CAF50';
                goToStep(4);
                console.log('데이터 저장 완료 (이미지)');
            };
            img.onerror = function() {
                // 오류가 발생해도 실제로는 데이터가 전송되었을 가능성이 높음
                btn.textContent = '저장 완료!';
                btn.style.background = '#4CAF50';
                goToStep(4);
                console.log('데이터 저장 완료 (이미지 오류지만 정상)');
            };
            
            img.src = fullUrl;
        }
        
    } catch (error) {
        btn.textContent = '저장 실패 - 다시 시도';
        btn.style.background = '#ff6b6b';
        btn.disabled = false;
        console.error('저장 오류:', error);
    }
}

// 진단 재시작
function restartDiagnosis() {
    // 모든 데이터 초기화
    currentStep = 1;
    userInfo = {};
    answers = {};
    diagnosisData = null;
    
    // 입력 필드 초기화
    var company = document.getElementById('company');
    var department = document.getElementById('department');
    var name = document.getElementById('name');
    if (company) company.value = '';
    if (department) department.value = '';
    if (name) name.value = '';
    
    // 질문 컨테이너 초기화
    var questionsContainer = document.getElementById('questions-container');
    if (questionsContainer) questionsContainer.innerHTML = '';
    
    // 진행률 초기화
    var progressBar = document.getElementById('progressBar');
    if (progressBar) progressBar.style.width = '0%';
    
    // 제출 버튼 초기화
    var submitBtn = document.getElementById('submitBtn');
    if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = '결과 확인하기';
    }
    
    // 모든 단계 초기화
    for (var i = 1; i <= 4; i++) {
        var section = document.getElementById('section' + i);
        var step = document.getElementById('step' + i);
        if (section) section.classList.remove('active');
        if (step) step.classList.remove('active', 'completed');
    }
    
    // 첫 번째 단계로 이동
    var section1 = document.getElementById('section1');
    var step1 = document.getElementById('step1');
    if (section1) section1.classList.add('active');
    if (step1) step1.classList.add('active');
}

// 이벤트 리스너 등록
document.addEventListener('DOMContentLoaded', function() {
    console.log('페이지 로드 완료');
    
    // 버튼 이벤트 리스너 등록
    var startBtn = document.getElementById('startBtn');
    if (startBtn) {
        startBtn.addEventListener('click', function() {
            goToStep(2);
        });
    }
    
    var prevBtn = document.getElementById('prevBtn');
    if (prevBtn) {
        prevBtn.addEventListener('click', function() {
            goToStep(1);
        });
    }
    
    var submitBtn = document.getElementById('submitBtn');
    if (submitBtn) {
        submitBtn.addEventListener('click', function() {
            goToStep(3);
        });
    }
    
    var saveBtn = document.getElementById('saveBtn');
    if (saveBtn) {
        saveBtn.addEventListener('click', saveDataAndGoToStep4);
    }
    
    var restartBtn = document.getElementById('restartBtn');
    if (restartBtn) {
        restartBtn.addEventListener('click', restartDiagnosis);
    }
});
</script>
</body>
</html>
